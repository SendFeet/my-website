<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Story of Enoch</title>

  <style>
    html { scroll-behavior: smooth; }

    body{
      margin:0;
      background:#1e1e1e;
      color:#d4d4d4;
      font-family:"Courier New", monospace;
      overflow:hidden;
    }

    /* Single centered scroll container */
    #viewport{
      height:100vh;
      width:100vw;
      overflow-y:auto;
      padding:44px 20px;
      box-sizing:border-box;
      display:flex;
      justify-content:center;
    }
    #viewport::-webkit-scrollbar{ width:0px; }

    #content{
      max-width:820px;
      width:100%;
      display:flex;
      flex-direction:column;
      font-size:17px;
      letter-spacing:0.01em;
      text-rendering:optimizeLegibility;
      -webkit-font-smoothing:antialiased;
      font-kerning:normal;
    }

    /* Verse layout: number + text */
    .verse{
      display:flex;
      align-items:flex-start;
      gap:14px;
      line-height:1.95em;
    }

    .vnum{
      width:28px;
      flex:0 0 28px;
      text-align:right;
      color:#bdbdbd;
      user-select:none;
      line-height:1.95em;
    }

    .vtext{
      flex:1;
      text-align:left;
      white-space:normal;
    }

    .para{
      margin:0;
    }

    .spacer{ height:1.1em; }

    /* Headers */
    .title{
      color:#4ec9b0;
      font-weight:700;
      font-size:1.25em;
      text-align:center;
      margin:0 0 1.2em 0;
    }

    .book{
      color:#d4d4d4;
      font-weight:700;
      text-align:center;
      margin:0.8em 0 0.8em 0;
      opacity:0.95;
    }

    .chapter{
      color:#569cd6;
      font-weight:700;
      text-align:center;
      margin:1.6em 0 1.0em 0;
    }

    .subhead{
      color:#d4d4d4;
      font-weight:700;
      text-align:center;
      margin:1.2em 0 1.0em 0;
      opacity:0.95;
    }

    .cursor{
      display:inline-block;
      width:8px;
      height:1em;
      margin-left:4px;
      background:#d4d4d4;
      vertical-align:bottom;
      animation:blink 1s infinite;
    }

    @keyframes blink {
      0%{opacity:1}
      50%{opacity:0}
      100%{opacity:1}
    }

    @media (max-width:768px){
      #viewport{ padding:34px 15px; }
      #content{ font-size:15px; }
      .vnum{ width:22px; flex-basis:22px; }
      .verse{ gap:12px; }
    }
  </style>
</head>

<body>
  <div id="viewport">
    <div id="content"></div>
  </div>

  <script>
    const content = document.getElementById("content");

    function addBlock(text, className) {
      const div = document.createElement("div");
      div.className = className;
      div.textContent = text;
      content.appendChild(div);
    }

    function addSpacer() {
      const s = document.createElement("div");
      s.className = "spacer";
      content.appendChild(s);
    }

    function addVerse(num, text) {
      const row = document.createElement("div");
      row.className = "verse";

      const n = document.createElement("div");
      n.className = "vnum";
      n.textContent = num;

      const t = document.createElement("div");
      t.className = "vtext";
      t.textContent = text;

      row.appendChild(n);
      row.appendChild(t);
      content.appendChild(row);
    }

    // Heuristic: short standalone lines become centered subheaders
    function isLikelySubhead(line) {
      const s = line.trim();
      if (!s) return false;
      if (s.length > 70) return false;
      if (/^(book\s+\d+\b|chapter\s+\d+\b)/i.test(s)) return false;
      if (/^\d+\s+/.test(s)) return false;
      // avoid lines that clearly continue prose
      if (/[\.;:]\s*$/.test(s)) return false;
      return true;
    }

    async function loadText() {
      try {
        const url = "Story%20of%20Enoch.txt"; // space-safe
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error("Fetch failed: " + res.status + " " + res.statusText);

        const raw = (await res.text()).replace(/\r/g, "");
        const lines = raw.split("\n");

        content.innerHTML = "";

        let currentVerseNum = null;
        let currentVerseText = "";

        function flushVerse() {
          if (currentVerseNum !== null) {
            addVerse(String(currentVerseNum), currentVerseText.trim());
            currentVerseNum = null;
            currentVerseText = "";
            addSpacer();
          }
        }

        for (let i = 0; i < lines.length; i++) {
          const line = lines[i];
          const trimmed = line.trimEnd();
          const t = trimmed.trim();

          if (!t) {
            // Blank line: end any open verse and add gentle spacing
            flushVerse();
            addSpacer();
            continue;
          }

          // Main title (first occurrence)
          if (t.toLowerCase() === "story of enoch" && !document.querySelector('.title')) {
            flushVerse();
            addBlock(t, "title");
            addSpacer();
            continue;
          }

          // Book header
          if (/^book\s+\d+\b/i.test(t)) {
            flushVerse();
            addBlock(t, "book");
            addSpacer();
            continue;
          }

          // Chapter header
          if (/^chapter\s+\d+\b/i.test(t)) {
            flushVerse();
            addBlock(t, "chapter");
            addSpacer();
            continue;
          }

          // Verse start: "1 ..."
          const m = t.match(/^(\d+)\s+(.*)$/);
          if (m) {
            flushVerse();
            currentVerseNum = Number(m[1]);
            currentVerseText = m[2];
            continue;
          }

          // Non-verse line: treat as subheader if it looks like one, otherwise append to current verse (or render as paragraph)
          if (isLikelySubhead(t)) {
            flushVerse();
            addBlock(t, "subhead");
            addSpacer();
            continue;
          }

          if (currentVerseNum !== null) {
            // Continuation of current verse: join with a space
            currentVerseText += (currentVerseText.endsWith("-") ? "" : " ") + t;
          } else {
            // Standalone prose (no verse number in file) â€” render as left paragraph
            addVerse("", t);
            addSpacer();
          }
        }

        flushVerse();

        // Cursor at end
        const end = document.createElement("div");
        end.className = "verse";
        end.innerHTML = "<div class='vnum'></div><div class='vtext'><span class='cursor'></span></div>";
        content.appendChild(end);

      } catch (err) {
        content.innerHTML = "";
        addBlock("Could not load Story of Enoch.txt", "title");
        addBlock(String(err), "subhead");
      }
    }

    loadText();
  </script>
</body>
</html>
