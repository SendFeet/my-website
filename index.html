<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Story of Enoch</title>

  <style>
    html { scroll-behavior: smooth; }

    body{
      margin:0;
      background:#1e1e1e;
      color:#d4d4d4;
      font-family:"Courier New", monospace;
      overflow:hidden;
    }

    /* Single centered scroll container */
    #viewport{
      height:100vh;
      width:100vw;
      overflow-y:auto;
      padding:40px 20px;
      box-sizing:border-box;
      display:flex;
      justify-content:center;
    }

    #viewport::-webkit-scrollbar{ width:0px; }

    #content{
      max-width:780px;
      width:100%;
      display:flex;
      flex-direction:column;
      font-size:17px;
      letter-spacing:0.01em;
      text-rendering:optimizeLegibility;
      -webkit-font-smoothing:antialiased;
      font-kerning:normal;
    }

    .line{
      white-space:pre-wrap;
      line-height:1.95em;
      text-align:left; /* left justify normal scripture */
      hyphens:auto;
    }

    /* Book-like indentation (disabled for headers and first line after a header) */
    .line.prose{
      text-indent:1.6em;
    }

    .line.noindent{
      text-indent:0;
    }

    /* true blank line between verses */
    .spacer{
      height:1.2em; /* subtle blank line */
    }

    .title { 
      color:#4ec9b0; 
      font-weight:700; 
      font-size:1.2em; 
      margin-bottom:1em;
      text-align:center; /* keep main title centered */
    }

    .chapter { 
      color:#569cd6; 
      font-weight:700; 
      margin-top:2em;
      margin-bottom:1em;
      text-align:center; /* keep chapter headers centered */
    }

    .cursor{
      display:inline-block;
      width:8px;
      height:1em;
      margin-left:4px;
      background:#d4d4d4;
      vertical-align:bottom;
      animation:blink 1s infinite;
    }

    @keyframes blink { 
      0%{opacity:1} 
      50%{opacity:0} 
      100%{opacity:1} 
    }

    @media (max-width:768px){
      #viewport{ padding:30px 15px; }
      #content{ max-width:100%; }
    }
  </style>
</head>

<body>
  <div id="viewport">
    <div id="content"></div>
  </div>

  <script>
    const content = document.getElementById("content");

    function addLine(text, className="") {
      const div = document.createElement("div");
      div.className = "line " + className;
      div.textContent = text;
      content.appendChild(div);
    }

    function addSpacer() {
      const spacer = document.createElement("div");
      spacer.className = "spacer";
      content.appendChild(spacer);
    }

    function classify(line) {
      const t = line.trim().toLowerCase();
      if (t === "story of enoch") return "title";
      if (t.startsWith("chapter")) return "chapter";
      return "";
    }

    async function loadText() {
      try {
        const url = "Story%20of%20Enoch.txt";
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error("Fetch failed: " + res.status);

        const text = await res.text();
        const lines = text.replace(/\r/g, "").split("\n");

        content.innerHTML = "";

        let prevWasHeader = true;

        for (const line of lines) {
          const cls = classify(line);

          if (cls === "title" || cls === "chapter") {
            addLine(line, cls);
            prevWasHeader = true;
          } else {
            // Normal prose line: indent, except right after a header
            const proseClass = prevWasHeader ? "noindent" : "prose";
            addLine(line, proseClass);
            prevWasHeader = false;
          }

          addSpacer();
        }

        // blinking cursor at end
        const end = document.createElement("div");
        end.className = "line";
        end.innerHTML = "<span class='cursor'></span>";
        content.appendChild(end);

      } catch (err) {
        content.innerHTML = "<div class='line'>Could not load text file.</div>";
      }
    }

    loadText();
  </script>
</body>
</html>
